environment:
  HEROKU_APP_PROD: durandal-gulp-boilerplate

general:
  branches:
    only:
      - master

dependencies:
  post:
    - bower install
    - gulp build

deployment:
  production:
    branch: master
    #heroku:
    #  appname: durandal-gulp-boilerplate
    commands:
      - heroku buildpacks:set https://github.com/heroku/heroku-buildpack-php --app $HEROKU_APP_PROD || true
      #- heroku config:set BUILDPACK_URL=https://github.com/heroku/heroku-buildpack-php.git --app $HEROKU_APP_PROD
      #- git branch -D deploy
      - git config --global user.name "${CIRCLE_USERNAME} $(CIRCLE_USERNAME)"
      - git config --global user.email "${CIRCLE_USERNAME} $(CIRCLE_USERNAME)"
      - git checkout -b deploy
      - git add -f dist/
      - git commit -m "Deploying to Heroku"
      - heroku maintenance:on --app $HEROKU_APP_PROD
      #- heroku scale worker=0 --app $HEROKU_APP_PROD
      - git push git@heroku.com:$HEROKU_APP_PROD.git -f deploy:master
      - heroku restart --app $HEROKU_APP_PROD
      #- heroku scale worker=1 --app $HEROKU_APP_PROD
      - heroku maintenance:off --app $HEROKU_APP_PROD
